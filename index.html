<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GPS Offline - Motoristas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #map { height: 70vh; width: 100%; }
    .box { padding: 20px; }
    input { padding: 10px; width: 100%; margin-top: 5px; font-size: 16px; }
  </style>
</head>
<body>

  <div class="box">
    <h2>GPS Grátis para Motoristas</h2>
    <label>Telefone do Motorista:</label>
    <input type="text" id="ownerPhone" placeholder="Digite seu número" />
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // === MAPA OFFLINE (Leaflet com tiles gratuitos) ===
    const map = L.map('map').setView([-22.4646, -42.6523], 12); // Cachoeiras de Macacu
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    L.marker([-22.4646, -42.6523]).addTo(map)
      .bindPopup('Cachoeiras de Macacu - RJ')
      .openPopup();


    /* ======= SALVAR NÚMERO DO MOTORISTA (LOCAL STORAGE) ======= */
    const savedOwnerPhone = localStorage.getItem("ownerPhone");
    if (savedOwnerPhone) {
        document.getElementById("ownerPhone").value = savedOwnerPhone;
    }

    document.getElementById("ownerPhone").addEventListener("input", (e) => {
        const clean = e.target.value.replace(/[^0-9]/g, "");
        e.target.value = clean;
        localStorage.setItem("ownerPhone", clean);
    });

  </script>
  <!-- Rastreamento em tempo real -->
  <script>
    function iniciarRastreamento() {
      if (!navigator.geolocation) {
        alert('Seu navegador não suporta geolocalização.');
        return;
      }

      navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          document.getElementById('gps-info').innerText = `Lat: ${lat}, Lon: ${lon}`;

          if (window.map && window.userMarker) {
            window.userMarker.setLatLng([lat, lon]);
            window.map.setView([lat, lon]);
          }
        },
        (err) => console.error(err),
        { enableHighAccuracy: true }
      );
    }

    function compartilharLocalizacao() {
      if (!navigator.geolocation) {
        alert('Seu navegador não suporta geolocalização.');
        return;
      }

      navigator.geolocation.getCurrentPosition((pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const link = `https://www.google.com/maps?q=${lat},${lon}`;
        const mensagem = encodeURIComponent(`Minha localização ao vivo: ${link}`);
        window.open(`https://wa.me/?text=${mensagem}`);
      });
    }
  </script>
</body>
</html>
